{% extends "adminpanel/base.html" %}
{% block content %}
<div class="page-header">
  <h1 class="page-title"><i class="fas fa-graduation-cap"></i>Manage Program Affiliation for {{ college.name }}</h1>
  <p class="page-subtitle">Select which programs this college should be affiliated with (program-wise, grouped by department).</p>
</div>

<div class="card">
  <div class="card-body">
    {% if not college.is_approved %}
    <div class="alert alert-warning">
      <i class="fas fa-exclamation-triangle me-2"></i>
      This college is not yet approved. Approve the college first before managing programs.
    </div>
    {% else %}
    <form method="post">
      {% csrf_token %}
      <p class="text-muted mb-4">
        Select the <strong>programs</strong> that this college wishes to offer. After selection, the affiliation request will be sent for university approval.
      </p>
      <div class="row g-3">
        {% for dept in departments %}
        <div class="col-md-6 col-lg-4">
          <div class="border rounded p-3 h-100">
            <h5 class="mb-2"><i class="fas fa-building me-1"></i>{{ dept.department.name }}</h5>
            <ul class="list-group list-group-flush">
              {% for program in dept.programs %}
              <li class="list-group-item">
                <label class="form-check-label w-100">
                  <input class="form-check-input me-2" type="checkbox" name="programs" value="{{ program.id }}" {% if program.id in affiliated_program_ids %}checked{% endif %}>
                  {{ program.name }}
                </label>
              </li>
              {% empty %}
              <li class="list-group-item text-muted">No programs available.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
        {% endfor %}
      </div>
      <hr class="my-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted">
          <i class="fas fa-info-circle me-1"></i>
          Current affiliation status:
          {% if college.affiliation_status == 'not_applied' %}
            <span class="badge bg-secondary">Not Applied</span>
          {% elif college.affiliation_status == 'pending' %}
            <span class="badge bg-warning text-dark">Pending</span>
          {% elif college.affiliation_status == 'approved' %}
            <span class="badge bg-success">Affiliated</span>
          {% else %}
            <span class="badge bg-danger">Rejected</span>
          {% endif %}
        </div>
        <div class="d-flex gap-2">
          <a href="{% url 'adminpanel:college_detail' college.id %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Cancel
          </a>
          <button type="submit" class="btn btn-royal">
            <i class="fas fa-save me-1"></i> Save Programs
          </button>
        </div>
      </div>
    </form>
    {% endif %}
  </div>
</div>
{% endblock %}
