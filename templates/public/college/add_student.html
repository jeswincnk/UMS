{% extends 'public/college/base.html' %}

{% block title %}Add Student - College Portal{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title"><i class="fas fa-user-plus"></i>Add New Student</h1>
  <p class="page-subtitle">Enroll a new student in your college</p>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <i class="fas fa-user"></i>Student Information
      </div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}
          
          <h6 class="text-muted mb-3 border-bottom pb-2">Personal Details</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">First Name *</label>
              <input type="text" name="first_name" class="form-control" required placeholder="Enter first name">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Last Name *</label>
              <input type="text" name="last_name" class="form-control" required placeholder="Enter last name">
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Email *</label>
              <input type="email" name="email" class="form-control" required placeholder="student@example.com">
              <small class="text-muted">This will be used for login</small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Phone</label>
              <input type="text" name="phone" class="form-control" placeholder="+91 9876543210">
            </div>
          </div>
          
          <h6 class="text-muted mb-3 border-bottom pb-2 mt-4">Academic Details</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Department *</label>
              <select name="department" class="form-select" required id="departmentSelect">
                <option value="">Select Department</option>
                {% for dept in departments %}
                <option value="{{ dept.department.id }}">
                  {{ dept.department.name }}
                </option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Program *</label>
              <select name="program" class="form-select" required id="programSelect" disabled>
                <option value="">Select Department First</option>
              </select>
            </div>
          </div>
          <!-- Affiliated programs data from server -->
          <script type="application/json" id="deptProgramsData">{{ dept_programs_json|safe }}</script>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Roll Number</label>
              <input type="text" name="roll_number" class="form-control" placeholder="e.g., 2024001">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Admission Date</label>
              <input type="date" name="admission_date" class="form-control">
            </div>
          </div>
          
          <h6 class="text-muted mb-3 border-bottom pb-2 mt-4">Account Password</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Password *</label>
              <input type="password" name="password" class="form-control" required placeholder="Create a password">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Confirm Password *</label>
              <input type="password" name="password_confirm" class="form-control" required placeholder="Confirm password">
            </div>
          </div>
          
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            The student will receive login credentials at the email address provided. They can use these to access the student portal.
          </div>
          
          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-royal">
              <i class="fas fa-user-plus me-2"></i>Add Student
            </button>
            <a href="{% url 'public:college_students' %}" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <i class="fas fa-info-circle"></i>Guidelines
      </div>
      <div class="card-body">
        <ul class="list-unstyled mb-0">
          <li class="mb-2">
            <i class="fas fa-check text-success me-2"></i>
            Email must be unique for each student
          </li>
          <li class="mb-2">
            <i class="fas fa-check text-success me-2"></i>
            Roll number should follow your college format
          </li>
          <li class="mb-2">
            <i class="fas fa-check text-success me-2"></i>
            Student can only enroll in affiliated departments
          </li>
          <li class="mb-2">
            <i class="fas fa-check text-success me-2"></i>
            Password must be at least 8 characters
          </li>
        </ul>
      </div>
    </div>
    
    <div class="card mt-4">
      <div class="card-header">
        <i class="fas fa-graduation-cap"></i>Your Departments
      </div>
      <div class="card-body">
        {% if departments %}
        <ul class="list-unstyled mb-0">
          {% for dept in departments %}
          <li class="mb-2">
            <i class="fas fa-university text-muted me-2"></i>
            {{ dept.department.name }}
            <small class="text-muted">({{ dept.department.programs.count }} programs)</small>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted mb-0">No departments affiliated yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const deptSelect = document.getElementById('departmentSelect');
  const programSelect = document.getElementById('programSelect');
  
  // Load affiliated programs data from the JSON script tag
  const deptProgramsData = JSON.parse(document.getElementById('deptProgramsData').textContent || '{}');
  
  deptSelect.addEventListener('change', function() {
    const deptId = this.value;
    const programs = deptProgramsData[deptId] || [];
    
    programSelect.innerHTML = '<option value="">Select Program</option>';
    
    if (programs.length > 0) {
      programs.forEach(function(prog) {
        const option = document.createElement('option');
        option.value = prog.id;
        option.textContent = prog.name;
        programSelect.appendChild(option);
      });
      programSelect.disabled = false;
    } else {
      programSelect.innerHTML = '<option value="">No programs available</option>';
      programSelect.disabled = true;
    }
  });
});
</script>
{% endblock %}
